# 在代码审查中需要注意什么
注意：在考虑这些要点时，请务必考虑[“规范审核标准”](standard.md)。

## 设计
在评论中要涵盖的最重要的事情是CL的整体设计。 CL中各种代码的交互是否有意义？此更改是属于您的代码库还是属于库？它是否与您系统的其他部分很好地集成？现在是添加此功能的好时机吗？

## 功能
这个CL是否符合开发人员的意图？开发人员对此代码的用户有什么好处？ “用户”通常都是最终用户（当他们受到更改影响时）和开发人员（将来必须“使用”此代码）。

大多数情况下，我们希望开发人员能够很好地测试CL，以便在他们进行代码审查时能够正常工作。但是，作为审阅者，您仍然应该考虑边缘情况，寻找并发问题，尝试像用户一样思考，并确保没有您通过阅读代码看到的错误。

您可以根据需要验证CL  - 审核者检查CL的行为时最重要的时间是面向用户的影响，例如UI更改。当您只是阅读代码时，很难理解某些更改会如何影响用户。对于这样的更改，您可以让开发人员为您提供功能演示，如果在CL中修补太不方便并自行尝试。

另一个在代码审查期间考虑功能特别重要的时候，如果CL中存在某种并行编程，理论上可能导致死锁或竞争条件。通过运行代码很难检测到这些类型的问题，并且通常需要某人（开发人员和审阅者）仔细思考它们以确保不会引入问题。 （请注意，这也是不使用竞争条件或死锁的并发模型的一个很好的理由 - 它可以使代码审查或理解代码变得非常复杂。）

## 复杂
CL比它应该更复杂吗？在CL的每个级别检查这一点是否过于复杂？功能太复杂了吗？课程太复杂了吗？ “过于复杂”通常意味着“代码阅读器无法快速理解”。它也可能意味着“开发人员在尝试调用或修改此代码时可能会引入错误。”

特定类型的复杂性是过度工程，其中开发人员使代码更加通用，或者添加系统当前不需要的功能。审稿人应特别警惕过度工程。鼓励开发人员解决他们现在需要解决的问题，而不是开发人员推测可能需要在未来解决的问题。未来的问题应该在它到达后解决，你可以在物理世界中看到它的实际形状和要求。

## 测试
要求进行适合变更的单元，集成或端到端测试。通常，除非CL处理紧急情况，否则应在与生产代码相同的CL中添加测试。

确保CL中的测试正确，合理且有用。测试不会自行测试，我们很少为测试编写测试 - 人类必须确保测试有效。

当代码被破坏时，测试是否真的会失败？如果代码在他们下面发生变化，他们会开始产生误报吗？每个测试都会做出简单而有用的断言吗？不同测试方法之间的测试是否适当分开？

请记住，测试也是必须维护的代码。不要仅仅因为它们不是主二进制文件的一部分而接受测试中的复杂性。

## 命名
开发人员是否为所有内容选择了好名字？一个好名字足够长，可以完全传达项目的内容或作用，而不会太长，以至于难以阅读。

## 评论
开发人员是否用可理解的英语撰写了清晰的评论？所有评论都是必要的吗？通常，当注释解释为什么存在某些代码时，注释很有用，并且不应该解释某些代码正在做什么。如果代码不够清楚，无法解释自己，那么代码应该变得更简单。有一些例外（正则表达式和复杂算法通常会从解释他们正在做的事情的评论中获益很多），但大多数评论都是针对代码本身不可能包含的信息，例如决策背后的推理。

查看此CL之前的注释也很有帮助。也许有一个TODO现在可以删除，一个评论建议不要进行这种改变，等等。

请注意，注释与类，模块或函数的文档不同，它们应该代表一段代码的目的，如何使用它，以及它在使用时的行为方式。

## 样式
我们为Google提供所有主要语言的风格指南，甚至包括大多数次要语言。确保CL遵循适当的样式指南。

如果你想改进样式指南中没有的一些样式点，请在评论前加上“Nit：”，让开发人员知道你认为这会改善代码，但不是强制性的。不要仅根据个人风格偏好阻止提交CL。

CL的作者不应包括与其他更改相结合的主要样式更改。它使得很难看到CL中的更改，使合并和回滚更复杂，并导致其他问题。例如，如果作者想要重新格式化整个文件，让他们只将重新格式化为一个CL，然后再发送另一个CL及其功能更改。

## 文档
如果CL更改了用户构建，测试，交互或发布代码的方式，请检查它是否还更新了相关文档，包括README，g3doc页面和任何生成的参考文档。如果CL删除或弃用代码，请考虑是否也应删除文档。如果缺少文档，请询问。

## 每一行
查看您已分配审核的每行代码。有些东西，比如数据文件，生成的代码或大型数据结构，你有时可以扫描，但不扫描人类编写的类，函数或代码块，并假设它内部的内容是可以的。显然，某些代码需要比其他代码更仔细的审查 - 这是你必须做出的判断调用 - 但你至少应该确定你理解所有代码正在做什么。

如果您阅读代码太难了，这会减慢审核速度，那么您应该让开发人员知道并等待他们在您尝试审核之前澄清它。在谷歌，我们聘请了优秀的软件工程师，你就是其中之一。如果您无法理解代码，那么很可能其他开发人员也不会。因此，当您要求开发人员澄清此代码时，您也会帮助未来的开发人员理解这些代码。

如果您了解代码但是您觉得没有资格进行某些部分的审核，请确保CL上有一个合格的审核人，特别是对于安全性，并发性，可访问性，国际化等复杂问题。

## 上下文
在广泛的背景下查看CL通常很有帮助。通常，代码审查工具只会显示围绕要更改的部分的几行代码。有时您必须查看整个文件以确保更改确实有意义。例如，您可能只看到添加了四个新行，但是当您查看整个文件时，您会看到这四行是50行方法，现在确实需要分解为更小的方法。

在整个系统的上下文中考虑CL也很有用。这个CL是否改善了系统的代码健康状况，还是使整个系统更复杂，测试更少等等？不接受降低系统代码运行状况的CL。大多数系统通过许多小的变化而变得复杂，因此在新变化中防止甚至很小的复杂性也很重要。

## 好东西
如果你在CL中看到一些不错的东西，请告诉开发人员，特别是当他们以一种很好的方式解决你的一条评论时。代码审查通常只关注错误，但它们也应该为良好实践提供鼓励和欣赏。在指导方面，有时甚至更有价值的是告诉开发人员他们做得对，而不是告诉他们他们做错了什么。

## 摘要
在进行代码审查时，您应该确保：

- 代码设计精良。
- 该功能对代码的用户有利。
- 任何UI更改都是明智的，看起来很好。
- 任何并行编程都是安全的。
- 代码并不比它需要的更复杂。
- 开发人员没有实现他们将来可能需要的东西，但现在还不知道他们需要的东西。
- 代码有适当的单元测试。
- 测试精心设计。
- 开发人员使用了清晰的名称。
- 评论是清楚和有用的，并且大多解释为什么而不是什么。
- 代码已适当记录（通常在g3doc中）。
- 代码符合我们的风格指南。

确保查看您被要求查看的每一行代码，查看上下文，确保您提高代码运行状况，并赞扬开发人员所做的好事。

下一步：[在审核中导航CL](navigate.md)
